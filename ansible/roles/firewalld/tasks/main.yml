---
- name: Install firewalld
  yum:
    name: firewalld
    state: present
  become: true

- name: Start Firewalld
  service:
    name: firewalld
    state: started
    enabled: true
  become: true

- name: Enable the dmz zone for internal connections
  firewalld:
    zone: dmz
    state: present
    permanent: true
  become: true

- name: Add trusted network IPs to DMZ group
  firewalld:
    zone: dmz
    state: enabled
    source: '{{ item }}'
    permanent: true
    immediate: true
  loop: '{{ trusted_networks }}'
  become: true
